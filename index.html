<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cl√≠nica Francielly Rodrigues - Sistema de Gest√£o</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0b1a33;
      --primary-light: #143059;
      --secondary: #4a6fa5;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --info: #17a2b8;
      --light: #f8f9fa;
      --dark: #343a40;
      --gray: #6c757d;
      --white: #ffffff;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }
    
    header {
      background: var(--primary);
      color: var(--white);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo i {
      font-size: 1.8rem;
      color: var(--secondary);
    }
    
    nav {
      background: var(--white);
      padding: 0.8rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    nav ul {
      display: flex;
      justify-content: center;
      list-style: none;
      gap: 1rem;
    }
    
    nav button {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 5px;
      background: var(--primary);
      color: var(--white);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    nav button:hover {
      background: var(--primary-light);
      transform: translateY(-2px);
    }
    
    nav button i {
      font-size: 0.9rem;
    }
    
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    
    .section {
      background: var(--white);
      border-radius: 8px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
      padding: 1.5rem;
      margin-bottom: 2rem;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .hidden {
      display: none;
    }
    
    h2 {
      color: var(--primary);
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--primary-light);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    h2 i {
      color: var(--secondary);
    }
    
    .card {
      background: var(--white);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 1rem;
      margin-bottom: 1rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border-left: 4px solid var(--primary);
    }
    
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
    }
    
    .card-body {
      margin-bottom: 0.5rem;
    }
    
    .card-footer {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.8rem;
    }
    
    button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: var(--white);
    }
    
    .btn-primary:hover {
      background: var(--primary-light);
    }
    
    .btn-success {
      background: var(--success);
      color: var(--white);
    }
    
    .btn-success:hover {
      background: #218838;
    }
    
    .btn-danger {
      background: var(--danger);
      color: var(--white);
    }
    
    .btn-danger:hover {
      background: #c82333;
    }
    
    .btn-warning {
      background: var(--warning);
      color: var(--dark);
    }
    
    .btn-warning:hover {
      background: #e0a800;
    }
    
    .btn-info {
      background: var(--info);
      color: var(--white);
    }
    
    .btn-info:hover {
      background: #138496;
    }
    
    .btn-sm {
      padding: 0.3rem 0.6rem;
      font-size: 0.85rem;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 1rem;
      font-family: inherit;
      transition: border 0.3s ease;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(11, 26, 51, 0.1);
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--primary);
    }
    
    .form-row {
      display: flex;
      gap: 1rem;
    }
    
    .form-row .form-group {
      flex: 1;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .status-scheduled {
      background: var(--info);
    }
    
    .status-completed {
      background: var(--success);
    }
    
    .status-canceled {
      background: var(--danger);
    }
    
    .status-missed {
      background: var(--warning);
    }
    
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 50px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .badge-primary {
      background: var(--primary-light);
      color: var(--white);
    }
    
    .badge-success {
      background: var(--success);
      color: var(--white);
    }
    
    .badge-danger {
      background: var(--danger);
      color: var(--white);
    }
    
    .badge-warning {
      background: var(--warning);
      color: var(--dark);
    }
    
    .badge-info {
      background: var(--info);
      color: var(--white);
    }
    
    .search-box {
      position: relative;
      margin-bottom: 1.5rem;
    }
    
    .search-box input {
      padding-left: 2.5rem;
    }
    
    .search-box i {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
    }
    
    .actions-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .calendar-view {
      display: flex;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .time-column {
      flex: 0 0 80px;
      background: #f8f9fa;
    }
    
    .time-slot {
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid #eee;
      font-size: 0.9rem;
      color: var(--gray);
    }
    
    .schedule-column {
      flex: 1;
      background: var(--white);
    }
    
    .schedule-slot {
      height: 60px;
      border-bottom: 1px solid #eee;
      position: relative;
      overflow: hidden;
    }
    
    .appointment {
      position: absolute;
      left: 0;
      right: 0;
      padding: 0.5rem;
      margin: 0.2rem;
      border-radius: 5px;
      font-size: 0.85rem;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .appointment:hover {
      transform: scale(1.02);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .appointment-primary {
      background: #e0f0ff;
      border-left: 3px solid var(--primary);
    }
    
    .appointment-success {
      background: #e6ffed;
      border-left: 3px solid var(--success);
    }
    
    .appointment-danger {
      background: #ffecec;
      border-left: 3px solid var(--danger);
    }
    
    .appointment-warning {
      background: #fff8e1;
      border-left: 3px solid var(--warning);
    }
    
    .appointment-title {
      font-weight: 600;
      margin-bottom: 0.2rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .appointment-time {
      font-size: 0.75rem;
      color: var(--gray);
    }
    
    .appointment-duration {
      font-size: 0.7rem;
      color: var(--gray);
      font-style: italic;
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background: var(--white);
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    
    .modal.active .modal-content {
      transform: translateY(0);
    }
    
    .modal-header {
      padding: 1rem;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary);
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray);
    }
    
    .modal-body {
      padding: 1rem;
    }
    
    .modal-footer {
      padding: 1rem;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 1.5rem;
    }
    
    .tab {
      padding: 0.8rem 1.5rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      font-weight: 500;
      color: var(--gray);
      transition: all 0.3s ease;
    }
    
    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }
    
    .tab:hover:not(.active) {
      color: var(--primary-light);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: var(--white);
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      text-align: center;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    
    .stat-label {
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .alert {
      padding: 1rem;
      border-radius: 5px;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .alert-success {
      background: #e6ffed;
      color: #28a745;
      border-left: 4px solid #28a745;
    }
    
    .alert-danger {
      background: #ffecec;
      color: #dc3545;
      border-left: 4px solid #dc3545;
    }
    
    .alert-warning {
      background: #fff8e1;
      color: #ffc107;
      border-left: 4px solid #ffc107;
    }
    
    .alert-info {
      background: #e0f7ff;
      color: #17a2b8;
      border-left: 4px solid #17a2b8;
    }
    
    /* Novo estilo para pacotes */
    .package-badge {
      background: #f0e6ff;
      color: #6f42c1;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.75rem;
      margin-left: 5px;
    }
    
    /* Estilo para selects m√∫ltiplos */
    select[multiple] {
      min-height: 150px;
      padding: 0.5rem;
    }
    
    select[multiple] option {
      padding: 0.5rem;
      margin: 2px 0;
      border-radius: 3px;
    }
    
    select[multiple] option:hover {
      background: #f0f0f0;
    }
    
    @media (max-width: 768px) {
      nav ul {
        flex-wrap: wrap;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .calendar-view {
        flex-direction: column;
      }
      
      .time-column {
        display: flex;
        flex: 1;
        overflow-x: auto;
      }
      
      .time-slot {
        width: 80px;
        flex-shrink: 0;
        height: 40px;
      }
      
      .schedule-column {
        overflow-x: auto;
      }
      
      .schedule-slot {
        height: 40px;
      }
      
      .modal-content {
        width: 95%;
      }
    }
  </style>

<script src="https://www.gstatic.com/firebasejs/11.7.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.7.3/firebase-database-compat.js"></script>
<script>

  
  import { getDatabase, ref, set, push, update, remove, get, child }
    from "https://www.gstatic.com/firebasejs/11.7.3/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAY34TCHirQIIvkgFbD6bKet2rOzYq_Qas",
    authDomain: "franclinica-6c86c.firebaseapp.com",
    databaseURL: "https://franclinica-6c86c-default-rtdb.firebaseio.com",
    projectId: "franclinica-6c86c",
    storageBucket: "franclinica-6c86c.firebasestorage.app",
    messagingSenderId: "940948970320",
    appId: "1:940948970320:web:b6f4a2776b0ebb100aaa55"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

</head>
<body>
  <header>
    <div class="logo">
      <i class="fas fa-clinic-medical"></i>
      <h1>Cl√≠nica Francielly Rodrigues</h1>
    </div>
    <div class="user-info">
      <span id="current-date"></span>
    </div>
  </header>

  <nav>
    <ul>
      <li>
        <button onclick="mostrar('dashboard')">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </button>
      </li>
      <li>
        <button onclick="mostrar('clientes')">
          <i class="fas fa-users"></i> Clientes
        </button>
      </li>
      <li>
        <button onclick="mostrar('agendamentos')">
          <i class="fas fa-calendar-alt"></i> Agendamentos
        </button>
      </li>
      <li>
        <button onclick="mostrar('procedimentos')">
          <i class="fas fa-procedures"></i> Procedimentos
        </button>
      </li>
      <li>
        <button onclick="mostrar('relatorios')">
          <i class="fas fa-chart-bar"></i> Relat√≥rios
        </button>
      </li>
    </ul>
  </nav>

  <div class="container">
    <!-- Dashboard -->
    <section id="dashboard" class="section">
      <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="total-clientes">0</div>
          <div class="stat-label">Clientes Cadastrados</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="total-agendamentos">0</div>
          <div class="stat-label">Agendamentos Hoje</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="total-procedimentos">0</div>
          <div class="stat-label">Procedimentos</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="faturamento-mes">R$ 0</div>
          <div class="stat-label">Faturamento Mensal</div>
        </div>
      </div>
      
      <div class="actions-bar">
        <h3><i class="fas fa-calendar-day"></i> Agenda do Dia</h3>
        <button class="btn-primary" onclick="mostrar('agendamentos')">
          <i class="fas fa-calendar-plus"></i> Novo Agendamento
        </button>
      </div>
      
      <div id="agenda-hoje"></div>
    </section>

    <!-- Clientes -->
    <section id="clientes" class="section hidden">
      <h2><i class="fas fa-users"></i> Gest√£o de Clientes</h2>
      
      <div class="actions-bar">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="buscaCliente" placeholder="Buscar cliente por nome, WhatsApp..." oninput="filtrarClientes()">
        </div>
        <button class="btn-primary" onclick="abrirModalCliente()">
          <i class="fas fa-plus"></i> Novo Cliente
        </button>
      </div>
      
      <div class="status-legend">
        <span><i class="fas fa-circle status-scheduled"></i> Agendado</span>
        <span><i class="fas fa-circle status-completed" style="margin-left:15px;"></i> Conclu√≠do</span>
        <span><i class="fas fa-circle status-canceled" style="margin-left:15px;"></i> Cancelado</span>
        <span><i class="fas fa-circle status-missed" style="margin-left:15px;"></i> Faltou</span>
      </div>
      
      <div id="listaClientes"></div>
    </section>

    <!-- Agendamentos -->
    <section id="agendamentos" class="section hidden">
      <h2><i class="fas fa-calendar-alt"></i> Agendamentos</h2>
      
      <div class="tabs">
        <div class="tab active" onclick="mudarAbaAgendamento('diario')">Vis√£o Di√°ria</div>
        <div class="tab" onclick="mudarAbaAgendamento('semanal')">Vis√£o Semanal</div>
        <div class="tab" onclick="mudarAbaAgendamento('mensal')">Vis√£o Mensal</div>
      </div>
      
      <div class="tab-content active" id="diario">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Data</label>
            <input type="date" id="dataAgendamento" onchange="carregarAgendamentosDiarios()">
          </div>
          <div class="form-group">
            <label class="form-label">Procedimento</label>
            <select id="filtroProcedimento" onchange="carregarAgendamentosDiarios()">
              <option value="">Todos os procedimentos</option>
            </select>
          </div>
        </div>
        
        <div class="calendar-view">
          <div class="time-column" id="colunaHoras"></div>
          <div class="schedule-column" id="listaAgendamentos"></div>
        </div>
      </div>
      
      <div class="tab-content" id="semanal">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Semana de</label>
            <input type="date" id="dataSemana" onchange="carregarAgendamentosSemanais()">
          </div>
        </div>
        <div id="agenda-semanal"></div>
      </div>
      
      <div class="tab-content" id="mensal">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">M√™s</label>
            <input type="month" id="dataMes" onchange="carregarAgendamentosMensais()">
          </div>
        </div>
        <div id="agenda-mensal"></div>
      </div>
    </section>

    <!-- Procedimentos -->
    <section id="procedimentos" class="section hidden">
      <h2><i class="fas fa-procedures"></i> Procedimentos</h2>
      
      <div class="actions-bar">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="buscaProcedimento" placeholder="Buscar procedimento..." oninput="filtrarProcedimentos()">
        </div>
        <div>
          <button class="btn-primary" onclick="abrirModalProcedimento()">
            <i class="fas fa-plus"></i> Novo Procedimento
          </button>
          <button class="btn-info" onclick="abrirModalPacote()">
            <i class="fas fa-boxes"></i> Pacotes
          </button>
        </div>
      </div>
      
      <div id="listaProcedimentos"></div>
    </section>

    <!-- Relat√≥rios -->
    <section id="relatorios" class="section hidden">
      <h2><i class="fas fa-chart-bar"></i> Relat√≥rios</h2>
      
      <div class="tabs">
        <div class="tab active" onclick="mudarAbaRelatorio('faturamento')">Faturamento</div>
        <div class="tab" onclick="mudarAbaRelatorio('procedimentos')">Procedimentos</div>
        <div class="tab" onclick="mudarAbaRelatorio('clientes')">Clientes</div>
        <div class="tab" onclick="mudarAbaRelatorio('pacotes')">Pacotes</div>
      </div>
      
      <div class="tab-content active" id="faturamento">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">De</label>
            <input type="date" id="dataInicioRelatorio">
          </div>
          <div class="form-group">
            <label class="form-label">At√©</label>
            <input type="date" id="dataFimRelatorio">
          </div>
          <div class="form-group">
            <button class="btn-primary" onclick="gerarRelatorioFaturamento()">
              <i class="fas fa-chart-line"></i> Gerar Relat√≥rio
            </button>
          </div>
        </div>
        
        <div id="grafico-faturamento"></div>
        <div id="tabela-faturamento"></div>
      </div>
      
      <div class="tab-content" id="procedimentos">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Per√≠odo</label>
            <select id="periodoProcedimentos">
              <option value="7">√öltimos 7 dias</option>
              <option value="30" selected>√öltimos 30 dias</option>
              <option value="90">√öltimos 3 meses</option>
              <option value="180">√öltimos 6 meses</option>
              <option value="365">√öltimo ano</option>
              <option value="custom">Personalizado</option>
            </select>
          </div>
          <div class="form-group" id="customProcedimentos" style="display:none;">
            <label class="form-label">Data Personalizada</label>
            <input type="date" id="dataCustomProcedimentos">
          </div>
          <div class="form-group">
            <button class="btn-primary" onclick="gerarRelatorioProcedimentos()">
              <i class="fas fa-chart-pie"></i> Gerar Relat√≥rio
            </button>
          </div>
        </div>
        
        <div id="grafico-procedimentos"></div>
        <div id="tabela-procedimentos"></div>
      </div>
      
      <div class="tab-content" id="clientes">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Ordenar por</label>
            <select id="ordenacaoClientes">
              <option value="frequencia">Frequ√™ncia</option>
              <option value="valor">Valor Gasto</option>
              <option value="recencia">Rec√™ncia</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Limite</label>
            <select id="limiteClientes">
              <option value="10">Top 10</option>
              <option value="20">Top 20</option>
              <option value="50">Top 50</option>
              <option value="100">Top 100</option>
              <option value="0">Todos</option>
            </select>
          </div>
          <div class="form-group">
            <button class="btn-primary" onclick="gerarRelatorioClientes()">
              <i class="fas fa-chart-bar"></i> Gerar Relat√≥rio
            </button>
          </div>
        </div>
        
        <div id="grafico-clientes"></div>
        <div id="tabela-clientes"></div>
      </div>
      
      <div class="tab-content" id="pacotes">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Per√≠odo</label>
            <select id="periodoPacotes">
              <option value="30" selected>√öltimos 30 dias</option>
              <option value="90">√öltimos 3 meses</option>
              <option value="180">√öltimos 6 meses</option>
              <option value="365">√öltimo ano</option>
            </select>
          </div>
          <div class="form-group">
            <button class="btn-primary" onclick="gerarRelatorioPacotes()">
              <i class="fas fa-box-open"></i> Gerar Relat√≥rio
            </button>
          </div>
        </div>
        
        <div id="grafico-pacotes"></div>
        <div id="tabela-pacotes"></div>
      </div>
    </section>
  </div>

  <!-- Modal Cliente -->
  <div class="modal" id="modalCliente">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalClienteTitulo">Novo Cliente</h3>
        <button class="modal-close" onclick="fecharModal('modalCliente')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nome Completo</label>
          <input type="text" id="nomeCliente" placeholder="Digite o nome completo">
        </div>
        <div class="form-group">
          <label class="form-label">WhatsApp (com DDD)</label>
          <input type="tel" id="whatsCliente" placeholder="Ex: 11987654321">
        </div>
        <div class="form-group">
          <label class="form-label">E-mail (opcional)</label>
          <input type="email" id="emailCliente" placeholder="Digite o e-mail">
        </div>
        <div class="form-group">
          <label class="form-label">Observa√ß√µes</label>
          <textarea id="obsCliente" rows="3" placeholder="Alergias, prefer√™ncias, etc."></textarea>
        </div>
        
        <h4>Procedimentos</h4>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Procedimento</label>
            <select id="procedimentoSelect">
              <option value="">Selecione um procedimento</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Desconto (R$)</label>
            <input type="number" id="descontoProcedimento" step="0.01" min="0" placeholder="0,00">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Data</label>
            <input type="date" id="dataProcedimento">
          </div>
          <div class="form-group">
            <label class="form-label">Hora</label>
            <input type="time" id="horaProcedimento">
          </div>
        </div>
        <button class="btn-primary btn-sm" onclick="adicionarProcedimentoCliente()">
          <i class="fas fa-plus"></i> Adicionar Procedimento
        </button>
        
        <div class="form-group">
          <label class="form-label">Ou selecione um pacote:</label>
          <select id="pacoteSelect" onchange="carregarDetalhesPacote()"></select>
          <button class="btn-primary btn-sm" onclick="adicionarPacoteCliente()">
            <i class="fas fa-box-open"></i> Adicionar Pacote
          </button>
        </div>
        
        <div id="listaProcedimentosCliente" style="margin-top:1rem;"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-danger" onclick="fecharModal('modalCliente')">Cancelar</button>
        <button class="btn-success" onclick="salvarCliente()">Salvar Cliente</button>
      </div>
    </div>
  </div>

  <!-- Modal Procedimento -->
  <div class="modal" id="modalProcedimento">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalProcedimentoTitulo">Novo Procedimento</h3>
        <button class="modal-close" onclick="fecharModal('modalProcedimento')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nome do Procedimento</label>
          <input type="text" id="nomeProcedimento" placeholder="Digite o nome do procedimento">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Pre√ßo (R$)</label>
            <input type="number" id="precoProcedimento" step="0.01" placeholder="0,00">
          </div>
          <div class="form-group">
            <label class="form-label">Dura√ß√£o (minutos)</label>
            <input type="number" id="duracaoProcedimento" placeholder="Tempo estimado">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Descri√ß√£o</label>
          <textarea id="descricaoProcedimento" rows="3" placeholder="Detalhes do procedimento"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">
            <input type="checkbox" id="habilitadoProcedimento" checked>
            Procedimento habilitado
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-danger" onclick="fecharModal('modalProcedimento')">Cancelar</button>
        <button class="btn-success" onclick="salvarProcedimento()">Salvar Procedimento</button>
      </div>
    </div>
  </div>

  <!-- Modal Pacote -->
  <div class="modal" id="modalPacote">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalPacoteTitulo">Novo Pacote</h3>
        <button class="modal-close" onclick="fecharModal('modalPacote')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nome do Pacote</label>
          <input type="text" id="nomePacote" placeholder="Nome do pacote">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Pre√ßo Total (R$)</label>
            <input type="number" id="precoPacote" step="0.01" min="0" placeholder="0,00">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Procedimentos Inclu√≠dos</label>
          <select id="procedimentosPacote" multiple style="height: 150px;">
            <!-- Preenchido dinamicamente -->
          </select>
          <small>Segure Ctrl para selecionar m√∫ltiplos</small>
        </div>
        <div class="form-group">
          <label class="form-label">Descri√ß√£o</label>
          <textarea id="descricaoPacote" rows="3" placeholder="Descri√ß√£o do pacote"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-danger" onclick="fecharModal('modalPacote')">Cancelar</button>
        <button class="btn-success" onclick="salvarPacote()">Salvar Pacote</button>
      </div>
    </div>
  </div>

  <!-- Modal Agendamento -->
  <div class="modal" id="modalAgendamento">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Detalhes do Agendamento</h3>
        <button class="modal-close" onclick="fecharModal('modalAgendamento')">&times;</button>
      </div>
      <div class="modal-body" id="detalhesAgendamento">
        <!-- Preenchido dinamicamente -->
      </div>
      <div class="modal-footer">
        <button class="btn-info" id="btnWhatsApp">
          <i class="fab fa-whatsapp"></i> Enviar Mensagem
        </button>
        <button class="btn-warning" id="btnFaltou">
          <i class="fas fa-user-times"></i> Cliente Faltou
        </button>
        <button class="btn-warning" id="btnEditarAgendamento">
          <i class="fas fa-edit"></i> Editar
        </button>
        <button class="btn-danger" id="btnCancelarAgendamento">
          <i class="fas fa-times"></i> Cancelar
        </button>
      </div>
    </div>
  </div>

  <script>
    // Vari√°veis globais atualizadas
    let clientes = []; // Dados vindos do Firebase
    let procedimentos = []; // Dados vindos do Firebase
    let pacotes = []; // Dados vindos do Firebase
    let clienteEditandoIndex = null;
    let procedimentosTemp = [];
    let agendamentoEditando = null;

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
  // Firebase - Carregamento inicial dos dados
  get(ref(db, 'clientes')).then(snapshot => {
    if (snapshot.exists()) {
      const data = snapshot.val();
      clientes = Object.entries(data).map(([id, cliente]) => ({ ...cliente, firebaseId: id }));
      listarClientes();
      carregarDashboard();
    }
  });

  get(ref(db, 'procedimentos')).then(snapshot => {
    if (snapshot.exists()) {
      procedimentos = Object.values(snapshot.val());
      carregarProcedimentosDropdown();
      listarProcedimentos();
    }
  });

  get(ref(db, 'pacotes')).then(snapshot => {
    if (snapshot.exists()) {
      pacotes = Object.values(snapshot.val());
      carregarPacotesDropdown();
    }
  });

      atualizarDataAtual();
      carregarProcedimentosDropdown();
      carregarPacotesDropdown();
      carregarDashboard();
      carregarAgendamentosDiarios();
      
      // Configurar data padr√£o para hoje
      const hoje = new Date().toISOString().split('T')[0];
      document.getElementById('dataAgendamento').value = hoje;
      document.getElementById('dataSemana').value = hoje;
      
      const mesAtual = new Date().toISOString().slice(0, 7);
      document.getElementById('dataMes').value = mesAtual;
      
      // Mostrar dashboard por padr√£o
      mostrar('dashboard');
    });

    // Fun√ß√µes utilit√°rias
    function formatarData(dataStr) {
      if (!dataStr) return '';
      const [y, m, d] = dataStr.split('-');
      return `${d}/${m}/${y}`;
    }

    function formatarMoeda(valor) {
      return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor || 0);
    }

    function atualizarDataAtual() {
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const hoje = new Date().toLocaleDateString('pt-BR', options);
      document.getElementById('current-date').textContent = hoje;
    }

    function salvarLocal() {
  // Substitu√≠do por Firebase
      /* salvar clientes no Firebase */
      /* salvar procedimentos no Firebase */
      /* salvar pacotes no Firebase */
    }

    // Fun√ß√µes de navega√ß√£o
    function mostrar(secao) {
      document.querySelectorAll(".section").forEach(s => s.classList.add("hidden"));
      document.getElementById(secao).classList.remove("hidden");
      
      // Atualizar dados espec√≠ficos da se√ß√£o quando aberta
      if (secao === 'clientes') {
        listarClientes();
      } else if (secao === 'dashboard') {
        carregarDashboard();
      } else if (secao === 'procedimentos') {
        listarProcedimentos();
      } else if (secao === 'agendamentos') {
        carregarAgendamentosDiarios();
      }
    }

    function mudarAbaAgendamento(aba) {
      document.querySelectorAll('#agendamentos .tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('#agendamentos .tab-content').forEach(content => content.classList.remove('active'));
      
      document.querySelector(`#agendamentos .tab[onclick="mudarAbaAgendamento('${aba}')"]`).classList.add('active');
      document.getElementById(aba).classList.add('active');
      
      // Carregar dados da aba selecionada
      if (aba === 'diario') {
        carregarAgendamentosDiarios();
      } else if (aba === 'semanal') {
        carregarAgendamentosSemanais();
      } else if (aba === 'mensal') {
        carregarAgendamentosMensais();
      }
    }

    function mudarAbaRelatorio(aba) {
      document.querySelectorAll('#relatorios .tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('#relatorios .tab-content').forEach(content => content.classList.remove('active'));
      
      document.querySelector(`#relatorios .tab[onclick="mudarAbaRelatorio('${aba}')"]`).classList.add('active');
      document.getElementById(aba).classList.add('active');
    }

    // Fun√ß√µes de modal
    function abrirModal(modalId, titulo = '') {
      if (titulo) {
        document.getElementById(`${modalId}Titulo`).textContent = titulo;
      }
      document.getElementById(modalId).classList.add('active');
    }

    function fecharModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    function abrirModalCliente(index = null) {
      clienteEditandoIndex = index;
      const modal = document.getElementById('modalCliente');
      
      // Limpar formul√°rio
      document.getElementById('nomeCliente').value = '';
      document.getElementById('whatsCliente').value = '';
      document.getElementById('emailCliente').value = '';
      document.getElementById('obsCliente').value = '';
      document.getElementById('descontoProcedimento').value = '0';
      procedimentosTemp = [];
      atualizarListaProcedimentosModal();
      
      if (index !== null) {
        // Modo edi√ß√£o
        document.getElementById('modalClienteTitulo').textContent = 'Editar Cliente';
        const cliente = clientes[index];
        
        document.getElementById('nomeCliente').value = cliente.nome || '';
        document.getElementById('whatsCliente').value = cliente.whatsapp || '';
        document.getElementById('emailCliente').value = cliente.email || '';
        document.getElementById('obsCliente').value = cliente.observacoes || '';
        
        procedimentosTemp = [...(cliente.procedimentos || [])];
      } else {
        // Modo novo cliente
        document.getElementById('modalClienteTitulo').textContent = 'Novo Cliente';
      }
      
      atualizarListaProcedimentosModal();
      abrirModal('modalCliente');
    }

    function abrirModalProcedimento(index = null) {
      const modal = document.getElementById('modalProcedimento');
      
      if (index !== null) {
        // Modo edi√ß√£o
        document.getElementById('modalProcedimentoTitulo').textContent = 'Editar Procedimento';
        const procedimento = procedimentos[index];
        
        document.getElementById('nomeProcedimento').value = procedimento.nome || '';
        document.getElementById('precoProcedimento').value = procedimento.preco || '';
        document.getElementById('duracaoProcedimento').value = procedimento.duracao || '';
        document.getElementById('descricaoProcedimento').value = procedimento.descricao || '';
        document.getElementById('habilitadoProcedimento').checked = procedimento.habilitado !== false;
      } else {
        // Modo novo procedimento
        document.getElementById('modalProcedimentoTitulo').textContent = 'Novo Procedimento';
        document.getElementById('nomeProcedimento').value = '';
        document.getElementById('precoProcedimento').value = '';
        document.getElementById('duracaoProcedimento').value = '';
        document.getElementById('descricaoProcedimento').value = '';
        document.getElementById('habilitadoProcedimento').checked = true;
      }
      
      abrirModal('modalProcedimento');
    }

    function abrirModalPacote(index = null) {
      const modal = document.getElementById('modalPacote');
      
      if (index !== null) {
        document.getElementById('modalPacoteTitulo').textContent = 'Editar Pacote';
        const pacote = pacotes[index];
        
        document.getElementById('nomePacote').value = pacote.nome;
        document.getElementById('precoPacote').value = pacote.preco;
        document.getElementById('descricaoPacote').value = pacote.descricao || '';
        
        // Preencher procedimentos do pacote
        const selectProcedimentos = document.getElementById('procedimentosPacote');
        selectProcedimentos.innerHTML = '';
        procedimentos.forEach(proc => {
          if (proc.habilitado !== false) {
            const option = document.createElement('option');
            option.value = proc.nome;
            option.textContent = `${proc.nome} - ${formatarMoeda(proc.preco)}`;
            option.selected = pacote.procedimentos.includes(proc.nome);
            selectProcedimentos.appendChild(option);
          }
        });
      } else {
        document.getElementById('modalPacoteTitulo').textContent = 'Novo Pacote';
        document.getElementById('nomePacote').value = '';
        document.getElementById('precoPacote').value = '';
        document.getElementById('descricaoPacote').value = '';
        
        // Preencher procedimentos dispon√≠veis
        const selectProcedimentos = document.getElementById('procedimentosPacote');
        selectProcedimentos.innerHTML = '';
        procedimentos.forEach(proc => {
          if (proc.habilitado !== false) {
            const option = document.createElement('option');
            option.value = proc.nome;
            option.textContent = `${proc.nome} - ${formatarMoeda(proc.preco)}`;
            selectProcedimentos.appendChild(option);
          }
        });
      }
      
      abrirModal('modalPacote');
    }

    function abrirModalAgendamento(clienteIndex, procedimentoIndex) {
      const cliente = clientes[clienteIndex];
      const procedimento = cliente.procedimentos[procedimentoIndex];
      agendamentoEditando = { clienteIndex, procedimentoIndex };
      
      const modalBody = document.getElementById('detalhesAgendamento');
      modalBody.innerHTML = `
        <div class="card">
          <div class="card-header">
            <h3>${cliente.nome}</h3>
            <span class="badge ${procedimento.cancelado ? 'badge-danger' : procedimento.faltou ? 'badge-warning' : new Date(procedimento.data + 'T' + procedimento.hora) < new Date() ? 'badge-success' : 'badge-primary'}">
              ${procedimento.cancelado ? 'Cancelado' : procedimento.faltou ? 'Faltou' : (new Date(procedimento.data + 'T' + procedimento.hora) < new Date() ? 'Conclu√≠do' : 'Agendado')}
            </span>
          </div>
          <div class="card-body">
            <p><strong>Procedimento:</strong> ${procedimento.procedimento} ${procedimento.pacote ? `<span class="package-badge">Pacote: ${procedimento.pacote}</span>` : ''}</p>
            <p><strong>Data:</strong> ${formatarData(procedimento.data)}</p>
            <p><strong>Hora:</strong> ${procedimento.hora}</p>
            <p><strong>Dura√ß√£o:</strong> ${procedimento.duracao || '30'} minutos</p>
            <p><strong>Valor:</strong> ${formatarMoeda(procedimento.precoComDesconto || procedimento.preco)} ${procedimento.desconto ? `(Desconto de ${formatarMoeda(procedimento.desconto)})` : ''}</p>
            <p><strong>WhatsApp:</strong> ${cliente.whatsapp}</p>
            ${cliente.email ? `<p><strong>E-mail:</strong> ${cliente.email}</p>` : ''}
            ${cliente.observacoes ? `<p><strong>Observa√ß√µes:</strong> ${cliente.observacoes}</p>` : ''}
          </div>
        </div>
      `;
      
      // Configurar bot√£o do WhatsApp com mensagem de confirma√ß√£o
      document.getElementById('btnWhatsApp').onclick = () => {
        const msg = encodeURIComponent(
          `Ol√° ${cliente.nome}, tudo bem? Aqui √© da Cl√≠nica Francielly Rodrigues.\n\n` +
          `Seu agendamento para ${procedimento.procedimento} est√° marcado para:\n` +
          `üìÖ ${formatarData(procedimento.data)}\n` +
          `‚è∞ ${procedimento.hora}\n` +
          `‚è≥ Dura√ß√£o: ${procedimento.duracao || '30'} minutos\n\n` +
          `Por favor, confirme se poder√° comparecer respondendo "SIM" ou "N√ÉO".\n\n` +
          `Agradecemos sua confirma√ß√£o!`
        );
        window.open(`https://wa.me/${cliente.whatsapp}?text=${msg}`, '_blank');
      };
      
      // Configurar bot√£o de falta
      document.getElementById('btnFaltou').onclick = () => {
        if (confirm('Deseja marcar este cliente como faltante? Uma mensagem ser√° enviada.')) {
          marcarFalta(clienteIndex, procedimentoIndex);
          fecharModal('modalAgendamento');
        }
      };
      
      // Configurar bot√£o de edi√ß√£o
      document.getElementById('btnEditarAgendamento').onclick = () => {
        editarAgendamento(clienteIndex, procedimentoIndex);
        fecharModal('modalAgendamento');
      };
      
      // Configurar bot√£o de cancelamento
      document.getElementById('btnCancelarAgendamento').onclick = () => {
        if (confirm('Deseja realmente cancelar este agendamento? Uma mensagem ser√° enviada ao cliente.')) {
          cancelarAgendamento(clienteIndex, procedimentoIndex);
          fecharModal('modalAgendamento');
        }
      };
      
      // Esconder bot√µes conforme status
      if (procedimento.cancelado) {
        document.getElementById('btnCancelarAgendamento').style.display = 'none';
        document.getElementById('btnFaltou').style.display = 'none';
      } else if (procedimento.faltou) {
        document.getElementById('btnFaltou').style.display = 'none';
      } else if (new Date(procedimento.data + 'T' + procedimento.hora) < new Date()) {
        document.getElementById('btnCancelarAgendamento').style.display = 'none';
        document.getElementById('btnFaltou').style.display = 'none';
      }
      
      abrirModal('modalAgendamento');
    }

    // Fun√ß√µes de clientes
    function listarClientes() {
      verificarPacotesPendentes();
      
      const lista = document.getElementById('listaClientes');
      lista.innerHTML = '';
      
      if (clientes.length === 0) {
        lista.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i> Nenhum cliente cadastrado ainda.</div>';
        return;
      }
      
      // Ordenar clientes pelo √∫ltimo procedimento agendado
      const clientesOrdenados = [...clientes].sort((a, b) => {
        const ultimoA = a.procedimentos && a.procedimentos.length > 0 ? 
          new Date(a.procedimentos[a.procedimentos.length - 1].data + 'T' + a.procedimentos[a.procedimentos.length - 1].hora) : new Date(0);
        const ultimoB = b.procedimentos && b.procedimentos.length > 0 ? 
          new Date(b.procedimentos[b.procedimentos.length - 1].data + 'T' + b.procedimentos[b.procedimentos.length - 1].hora) : new Date(0);
        return ultimoB - ultimoA;
      });
      
      clientesOrdenados.forEach((cliente, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        
        let procedimentosHtml = '<ul style="margin-top:10px;">';
        (cliente.procedimentos || []).forEach((p, pIndex) => {
          const dt = new Date(p.data + 'T' + p.hora);
          let statusClass = 'status-scheduled';
          let statusIcon = '<i class="far fa-clock"></i>';
          
          if (p.cancelado) {
            statusClass = 'status-canceled';
            statusIcon = '<i class="fas fa-ban"></i>';
          } else if (p.faltou) {
            statusClass = 'status-missed';
            statusIcon = '<i class="fas fa-user-times"></i>';
          } else if (dt < new Date()) {
            statusClass = 'status-completed';
            statusIcon = '<i class="fas fa-check"></i>';
          }
          
          procedimentosHtml += `
            <li style="margin-bottom:5px; display:flex; align-items:center;">
              <span class="${statusClass}" style="margin-right:5px;">${statusIcon}</span>
              <span>${p.procedimento} ${p.pacote ? `<span class="package-badge">${p.pacote}</span>` : ''} - ${formatarData(p.data)} √†s ${p.hora}</span>
            </li>
          `;
        });
        procedimentosHtml += '</ul>';
        
        card.innerHTML = `
          <div class="card-header">
            <div class="card-title">${cliente.nome}</div>
            <div>
              <span class="badge badge-primary">${cliente.procedimentos ? cliente.procedimentos.length : 0} procedimentos</span>
            </div>
          </div>
          <div class="card-body">
            <p><i class="fas fa-phone-alt"></i> ${cliente.whatsapp}</p>
            ${cliente.email ? `<p><i class="fas fa-envelope"></i> ${cliente.email}</p>` : ''}
            ${procedimentosHtml}
          </div>
          <div class="card-footer">
            <button class="btn-info btn-sm" onclick="contatarCliente('${cliente.whatsapp}')">
              <i class="fab fa-whatsapp"></i> WhatsApp
            </button>
            <button class="btn-primary btn-sm" onclick="abrirModalCliente(${index})">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button class="btn-danger btn-sm" onclick="excluirCliente(${index})">
              <i class="fas fa-trash"></i> Excluir
            </button>
          </div>
        `;
        
        lista.appendChild(card);
      });
    }

    function filtrarClientes() {
      const termo = document.getElementById('buscaCliente').value.toLowerCase().trim();
      const cards = document.querySelectorAll('#listaClientes .card');
      
      cards.forEach(card => {
        const texto = card.textContent.toLowerCase();
        card.style.display = texto.includes(termo) ? 'block' : 'none';
      });
    }

    

function salvarCliente() {
  const nome = document.getElementById('nomeCliente').value.trim();
  let whatsapp = document.getElementById('whatsCliente').value.trim().replace(/\D/g, '');
  const email = document.getElementById('emailCliente').value.trim();
  const observacoes = document.getElementById('obsCliente').value.trim();

  if (!nome || !whatsapp || whatsapp.length < 11) {
    alert('Preencha nome e WhatsApp corretamente.');
    return;
  }

  whatsapp = '+' + whatsapp;

  if (procedimentosTemp.length === 0) {
    alert('Adicione pelo menos um procedimento.');
    return;
  }

  const cliente = {
    nome,
    whatsapp,
    email,
    observacoes,
    procedimentos: [...procedimentosTemp]
  };

  if (clienteEditandoIndex !== null && clientes[clienteEditandoIndex].firebaseId) {
    const id = clientes[clienteEditandoIndex].firebaseId;
    firebase.database().ref('clientes/' + id).update(cliente);
  } else {
    const novoRef = firebase.database().ref('clientes').push();
    novoRef.set(cliente);
  }

  fecharModal('modalCliente');
  listarClientes();
}


  if (!whatsapp || whatsapp.length < 11) {
    alert('Por favor, informe um n√∫mero de WhatsApp v√°lido com DDD.');
    return;
  }

  whatsapp = '+' + whatsapp;

  if (procedimentosTemp.length === 0) {
    alert('Por favor, adicione pelo menos um procedimento para o cliente.');
    return;
  }

  const cliente = {
    nome,
    whatsapp,
    email,
    observacoes,
    procedimentos: [...procedimentosTemp]
  };

  if (clienteEditandoIndex !== null && clientes[clienteEditandoIndex].firebaseId) {
    const id = clientes[clienteEditandoIndex].firebaseId;
    update(ref(db, 'clientes/' + id), cliente);
  } else {
    const novoRef = push(ref(db, 'clientes'));
    set(novoRef, cliente);
  }

  fecharModal('modalCliente');
  listarClientes();
  carregarDashboard();
}

      
      
      salvarLocal();{
      fecharModal('modalCliente');
      listarClientes();
      carregarDashboard();
    }

    function excluirCliente(index) {
      if (confirm('Tem certeza que deseja excluir este cliente e todos os seus agendamentos?')) {
        clientes.splice(index, 1);
        salvarLocal();
        listarClientes();
        carregarDashboard();
      }
    }

    function contatarCliente(whatsapp) {
      window.open(`https://wa.me/${whatsapp}`, '_blank');
    }

    // Fun√ß√µes de procedimentos do cliente
    function carregarProcedimentosDropdown() {
      const select = document.getElementById('procedimentoSelect');
      const selectFiltro = document.getElementById('filtroProcedimento');
      
      // Limpar selects
      select.innerHTML = '<option value="">Selecione um procedimento</option>';
      selectFiltro.innerHTML = '<option value="">Todos os procedimentos</option>';
      
      // Adicionar procedimentos habilitados
      procedimentos.forEach(p => {
        if (p.habilitado !== false) {
          const option = document.createElement('option');
          option.value = p.nome;
          option.textContent = `${p.nome} - ${formatarMoeda(p.preco)} (${p.duracao || 30} min)`;
          select.appendChild(option.cloneNode(true));
          
          // Para o select de filtro tamb√©m
          selectFiltro.appendChild(option);
        }
      });
    }

    function carregarPacotesDropdown() {
      const select = document.getElementById('pacoteSelect');
      select.innerHTML = '<option value="">Selecione um pacote (opcional)</option>';
      
      pacotes.forEach(pacote => {
        if (pacote.habilitado !== false) {
          const option = document.createElement('option');
          option.value = pacote.nome;
          option.textContent = `${pacote.nome} - ${formatarMoeda(pacote.preco)} (${pacote.procedimentos.length} procedimentos)`;
          select.appendChild(option);
        }
      });
    }

    function carregarDetalhesPacote() {
      const pacoteNome = document.getElementById('pacoteSelect').value;
      if (!pacoteNome) return;
      
      const pacote = pacotes.find(p => p.nome === pacoteNome);
      if (pacote) {
        alert(`Pacote ${pacote.nome}:\n\n` +
              `- ${pacote.procedimentos.join('\n- ')}\n\n` +
              `Pre√ßo total: ${formatarMoeda(pacote.preco)}\n` +
              `(Economia de aproximadamente ${formatarMoeda(pacote.procedimentos.reduce((total, procNome) => {
                const proc = procedimentos.find(p => p.nome === procNome);
                return total + (proc ? proc.preco : 0);
              }, 0) - pacote.preco)})`);
      }
    }

    function adicionarProcedimentoCliente() {
      const procedimentoNome = document.getElementById('procedimentoSelect').value;
      const data = document.getElementById('dataProcedimento').value;
      const hora = document.getElementById('horaProcedimento').value;
      const desconto = parseFloat(document.getElementById('descontoProcedimento').value) || 0;
      
      if (!procedimentoNome || !data || !hora) {
        alert('Por favor, preencha todos os campos do procedimento.');
        return;
      }
      
      // Verificar conflito de hor√°rio
      const procedimentoCompleto = procedimentos.find(p => p.nome === procedimentoNome);
      const duracao = procedimentoCompleto ? procedimentoCompleto.duracao : 30;
      
      if (verificarConflitoAgendamento(data, hora, duracao)) {
        alert('J√° existe um agendamento para este hor√°rio. Por favor, escolha outro hor√°rio.');
        return;
      }
      
      const precoOriginal = procedimentoCompleto ? procedimentoCompleto.preco : 0;
      const precoComDesconto = precoOriginal - desconto;
      
      procedimentosTemp.push({
        procedimento: procedimentoNome,
        data,
        hora,
        preco: precoOriginal,
        precoComDesconto,
        desconto,
        duracao,
        cancelado: false,
        faltou: false
      });
      
      // Limpar campos
      document.getElementById('dataProcedimento').value = '';
      document.getElementById('horaProcedimento').value = '';
      document.getElementById('descontoProcedimento').value = '0';
      
      atualizarListaProcedimentosModal();
    }

    function adicionarPacoteCliente() {
      const pacoteNome = document.getElementById('pacoteSelect').value;
      const data = document.getElementById('dataProcedimento').value;
      const hora = document.getElementById('horaProcedimento').value;
      
      if (!pacoteNome || !data || !hora) {
        alert('Por favor, preencha todos os campos para adicionar o pacote.');
        return;
      }
      
      const pacote = pacotes.find(p => p.nome === pacoteNome);
      if (!pacote) return;
      
      // Verificar conflito para o primeiro procedimento
      const primeiroProcedimento = procedimentos.find(p => p.nome === pacote.procedimentos[0]);
      const duracao = primeiroProcedimento ? primeiroProcedimento.duracao : 30;
      
      if (verificarConflitoAgendamento(data, hora, duracao)) {
        alert('J√° existe um agendamento para o hor√°rio do primeiro procedimento. Por favor, escolha outro hor√°rio.');
        return;
      }
      
      // Adiciona o primeiro procedimento com data/hora, os outros sem
      pacote.procedimentos.forEach((procNome, index) => {
        const procedimentoCompleto = procedimentos.find(p => p.nome === procNome);
        const precoUnitario = pacote.preco / pacote.procedimentos.length;
        
        procedimentosTemp.push({
          procedimento: procNome,
          data: index === 0 ? data : '',
          hora: index === 0 ? hora : '',
          preco: procedimentoCompleto ? procedimentoCompleto.preco : 0,
          precoComDesconto: precoUnitario,
          desconto: procedimentoCompleto ? procedimentoCompleto.preco - precoUnitario : 0,
          duracao: procedimentoCompleto ? procedimentoCompleto.duracao : 30,
          pacote: pacote.nome,
          cancelado: false,
          faltou: false
        });
      });
      
      // Limpar campos
      document.getElementById('dataProcedimento').value = '';
      document.getElementById('horaProcedimento').value = '';
      document.getElementById('pacoteSelect').value = '';
      
      alert(`Pacote ${pacote.nome} adicionado. O primeiro procedimento est√° agendado, os demais precisar√£o ser agendados posteriormente.`);
      atualizarListaProcedimentosModal();
    }

    function verificarConflitoAgendamento(data, hora, duracao, ignorarIndex = null) {
      const inicio = new Date(`${data}T${hora}`);
      const fim = new Date(inicio.getTime() + (duracao || 30) * 60000);
      
      // Verificar conflitos com agendamentos existentes
      for (const [cIndex, cliente] of clientes.entries()) {
        for (const [pIndex, proc] of (cliente.procedimentos || []).entries()) {
          if (ignorarIndex && ignorarIndex.clienteIndex === cIndex && ignorarIndex.procedimentoIndex === pIndex) {
            continue;
          }
          
          if (!proc.cancelado && !proc.faltou) {
            const procInicio = new Date(`${proc.data}T${proc.hora}`);
            const procDuracao = proc.duracao || 30;
            const procFim = new Date(procInicio.getTime() + procDuracao * 60000);
            
            if ((inicio >= procInicio && inicio < procFim) || 
                (fim > procInicio && fim <= procFim) ||
                (inicio <= procInicio && fim >= procFim)) {
              return true;
            }
          }
        }
      }
      
      // Verificar conflitos com procedimentos tempor√°rios
      for (const [index, proc] of procedimentosTemp.entries()) {
        if (ignorarIndex !== index && proc.data && proc.hora && !proc.cancelado && !proc.faltou) {
          const procInicio = new Date(`${proc.data}T${proc.hora}`);
          const procDuracao = proc.duracao || 30;
          const procFim = new Date(procInicio.getTime() + procDuracao * 60000);
          
          if ((inicio >= procInicio && inicio < procFim) || 
              (fim > procInicio && fim <= procFim) ||
              (inicio <= procInicio && fim >= procFim)) {
            return true;
          }
        }
      }
      
      return false;
    }

    function atualizarListaProcedimentosModal() {
      const lista = document.getElementById('listaProcedimentosCliente');
      lista.innerHTML = '';
      
      if (procedimentosTemp.length === 0) {
        lista.innerHTML = '<p style="color:#666; font-style:italic;">Nenhum procedimento adicionado.</p>';
        return;
      }
      
      procedimentosTemp.forEach((proc, index) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.style.marginBottom = '10px';
        div.style.padding = '10px';
        
        const dt = proc.data ? new Date(proc.data + 'T' + proc.hora) : null;
        let statusClass = 'status-scheduled';
        let statusText = proc.data ? 'Agendado' : 'N√£o agendado';
        
        if (proc.cancelado) {
          statusClass = 'status-canceled';
          statusText = 'Cancelado';
        } else if (proc.faltou) {
          statusClass = 'status-missed';
          statusText = 'Faltou';
        } else if (dt && dt < new Date()) {
          statusClass = 'status-completed';
          statusText = 'Conclu√≠do';
        }
        
        div.innerHTML = `
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
              <span class="${statusClass}"></span>
              <strong>${proc.procedimento}</strong>
              ${proc.pacote ? `<span class="package-badge">${proc.pacote}</span>` : ''}
              <span style="margin-left:10px;">${proc.data ? `${formatarData(proc.data)} √†s ${proc.hora}` : 'Sem data agendada'}</span>
            </div>
            <div>
              <button class="btn-danger btn-sm" onclick="removerProcedimentoTemp(${index})">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <div style="margin-top:5px;">
            <small>
              Pre√ßo: ${formatarMoeda(proc.precoComDesconto || proc.preco)} 
              ${proc.desconto ? `(Desconto de ${formatarMoeda(proc.desconto)})` : ''} | 
              Dura√ß√£o: ${proc.duracao || 30} min
            </small>
          </div>
        `;
        
        lista.appendChild(div);
      });
    }

    function removerProcedimentoTemp(index) {
      // Se for um procedimento de pacote, perguntar se quer remover todos
      const proc = procedimentosTemp[index];
      if (proc.pacote) {
        if (confirm(`Este procedimento faz parte do pacote "${proc.pacote}". Deseja remover todos os procedimentos deste pacote?`)) {
          procedimentosTemp = procedimentosTemp.filter(p => p.pacote !== proc.pacote);
        } else {
          procedimentosTemp.splice(index, 1);
        }
      } else {
        procedimentosTemp.splice(index, 1);
      }
      atualizarListaProcedimentosModal();
    }

    // Fun√ß√µes de procedimentos (servi√ßos)
    function listarProcedimentos() {
      const lista = document.getElementById('listaProcedimentos');
      lista.innerHTML = '';
      
      if (procedimentos.length === 0) {
        lista.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i> Nenhum procedimento cadastrado ainda.</div>';
        return;
      }
      
      procedimentos.forEach((proc, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        
        card.innerHTML = `
          <div class="card-header">
            <div class="card-title">${proc.nome} ${proc.habilitado === false ? '<span style="color:#dc3545;">(Desabilitado)</span>' : ''}</div>
            <div>
              <span class="badge badge-primary">${formatarMoeda(proc.preco)}</span>
              <span class="badge ${proc.habilitado === false ? 'badge-danger' : 'badge-success'}" style="margin-left:5px;">
                ${proc.habilitado === false ? 'Inativo' : 'Ativo'}
              </span>
            </div>
          </div>
          <div class="card-body">
            <p><strong>Dura√ß√£o:</strong> ${proc.duracao || '30'} minutos</p>
            ${proc.descricao ? `<p><strong>Descri√ß√£o:</strong> ${proc.descricao}</p>` : ''}
          </div>
          <div class="card-footer">
            <button class="btn-primary btn-sm" onclick="abrirModalProcedimento(${index})">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button class="${proc.habilitado === false ? 'btn-success' : 'btn-warning'} btn-sm" onclick="toggleHabilitarProcedimento(${index})">
              <i class="fas ${proc.habilitado === false ? 'fa-check' : 'fa-ban'}"></i> ${proc.habilitado === false ? 'Habilitar' : 'Desabilitar'}
            </button>
            <button class="btn-danger btn-sm" onclick="excluirProcedimento(${index})">
              <i class="fas fa-trash"></i> Excluir
            </button>
          </div>
        `;
        
        lista.appendChild(card);
      });
    }

    function toggleHabilitarProcedimento(index) {
      procedimentos[index].habilitado = !procedimentos[index].habilitado;
      salvarLocal();
      listarProcedimentos();
      carregarProcedimentosDropdown();
      carregarPacotesDropdown();
    }

    function filtrarProcedimentos() {
      const termo = document.getElementById('buscaProcedimento').value.toLowerCase().trim();
      const cards = document.querySelectorAll('#listaProcedimentos .card');
      
      cards.forEach(card => {
        const texto = card.textContent.toLowerCase();
        card.style.display = texto.includes(termo) ? 'block' : 'none';
      });
    }

    function salvarProcedimento() {
      const nome = document.getElementById('nomeProcedimento').value.trim();
      const preco = parseFloat(document.getElementById('precoProcedimento').value);
      const duracao = parseInt(document.getElementById('duracaoProcedimento').value) || 30;
      const descricao = document.getElementById('descricaoProcedimento').value.trim();
      const habilitado = document.getElementById('habilitadoProcedimento').checked;
      
      if (!nome || isNaN(preco)) {
        alert('Por favor, informe pelo menos o nome e o pre√ßo do procedimento.');
        return;
      }
      
      const procedimento = {
        nome,
        preco,
        duracao,
        descricao,
        habilitado
      };
      
      // Se estiver editando, encontrar o √≠ndice
      const tituloModal = document.getElementById('modalProcedimentoTitulo').textContent;
      if (tituloModal.startsWith('Editar')) {
        // Encontrar o √≠ndice do procedimento que est√° sendo editado
        const nomeOriginal = tituloModal.replace('Editar Procedimento - ', '').trim();
        const index = procedimentos.findIndex(p => p.nome === nomeOriginal);
        
        if (index !== -1) {
          // Atualizar procedimentos em todos os clientes
          clientes.forEach(cliente => {
            cliente.procedimentos.forEach(proc => {
              if (proc.procedimento === nomeOriginal) {
                proc.procedimento = nome;
                proc.preco = preco;
                proc.duracao = duracao;
              }
            });
          });
          
          procedimentos[index] = procedimento;
        }
      } else {
        // Novo procedimento
        procedimentos.push(procedimento);
      }
      
      salvarLocal();
      fecharModal('modalProcedimento');
      listarProcedimentos();
      carregarProcedimentosDropdown();
      carregarPacotesDropdown();
      carregarDashboard();
    }

    function salvarPacote() {
      const nome = document.getElementById('nomePacote').value.trim();
      const preco = parseFloat(document.getElementById('precoPacote').value);
      const descricao = document.getElementById('descricaoPacote').value.trim();
      
      const selectProcedimentos = document.getElementById('procedimentosPacote');
      const procedimentosSelecionados = Array.from(selectProcedimentos.selectedOptions)
        .map(option => option.value);
      
      if (!nome || isNaN(preco)) {
        alert('Por favor, informe pelo menos o nome e o pre√ßo do pacote.');
        return;
      }
      
      if (procedimentosSelecionados.length === 0) {
        alert('Por favor, selecione pelo menos um procedimento para o pacote.');
        return;
      }
      
      const pacote = {
        nome,
        preco,
        descricao,
        procedimentos: procedimentosSelecionados,
        habilitado: true
      };
      
      const tituloModal = document.getElementById('modalPacoteTitulo').textContent;
      if (tituloModal.startsWith('Editar')) {
        const nomeOriginal = tituloModal.replace('Editar Pacote - ', '').trim();
        const index = pacotes.findIndex(p => p.nome === nomeOriginal);
        if (index !== -1) {
          pacotes[index] = pacote;
        }
      } else {
        pacotes.push(pacote);
      }
      
      salvarLocal();
      fecharModal('modalPacote');
      carregarPacotesDropdown();
    }

    function excluirProcedimento(index) {
      if (confirm('Tem certeza que deseja excluir este procedimento? Isso n√£o afetar√° os agendamentos j√° existentes, mas o procedimento n√£o estar√° mais dispon√≠vel para novos agendamentos.')) {
        procedimentos.splice(index, 1);
        salvarLocal();
        listarProcedimentos();
        carregarProcedimentosDropdown();
        carregarPacotesDropdown();
        carregarDashboard();
      }
    }

    // Fun√ß√µes de agendamentos
       function carregarAgendamentosDiarios() {
      const dataSelecionada = document.getElementById('dataAgendamento').value;
      const procedimentoFiltro = document.getElementById('filtroProcedimento').value;
      
      if (!dataSelecionada) return;
      
      const horasColuna = document.getElementById('colunaHoras');
      const agendamentosColuna = document.getElementById('listaAgendamentos');
      
      horasColuna.innerHTML = '';
      agendamentosColuna.innerHTML = '';
      
      // Criar coluna de horas (7h √†s 21h) em intervalos de 30 minutos
      for (let h = 7; h <= 21; h++) {
        for (let m = 0; m < 60; m += 30) {
          const hora = h.toString().padStart(2, '0') + ':' + m.toString().padStart(2, '0');
          
          // Coluna de horas
          const horaDiv = document.createElement('div');
          horaDiv.className = 'time-slot';
          horaDiv.textContent = hora;
          horasColuna.appendChild(horaDiv);
          
          // Coluna de agendamentos
          const slotDiv = document.createElement('div');
          slotDiv.className = 'schedule-slot';
          agendamentosColuna.appendChild(slotDiv);
        }
      }
      
 // Criar coluna de horas (7h √†s 21h) em intervalos de 30 minutos
      for (let h = 7; h <= 21; h++) {
        for (let m = 0; m < 60; m += 30) {
          const hora = h.toString().padStart(2, '0') + ':' + m.toString().padStart(2, '0');
          
          // Coluna de horas
          const horaDiv = document.createElement('div');
          horaDiv.className = 'time-slot';
          horaDiv.textContent = hora;
          horasColuna.appendChild(horaDiv);
          
          // Coluna de agendamentos
          const slotDiv = document.createElement('div');
          slotDiv.className = 'schedule-slot';
          agendamentosColuna.appendChild(slotDiv);
        }
      }
      
      // Preencher agendamentos considerando a dura√ß√£o
      clientes.forEach((cliente, clienteIndex) => {
        cliente.procedimentos.forEach((proc, procIndex) => {
          if (proc.data === dataSelecionada && 
              (!procedimentoFiltro || proc.procedimento === procedimentoFiltro) &&
              !proc.cancelado) {
            
            const hora = proc.hora;
            const [horaStr, minutoStr] = hora.split(':');
            const horaNum = parseInt(horaStr);
            const minutoNum = parseInt(minutoStr);
            
            if (horaNum >= 7 && horaNum <= 21) {
              // Calcular slots necess√°rios baseado na dura√ß√£o
              const procedimentoCompleto = procedimentos.find(p => p.nome === proc.procedimento) || {};
              const duracao = proc.duracao || procedimentoCompleto.duracao || 30;
              const slotsNecessarios = Math.ceil(duracao / 30);
              const slotIndex = ((horaNum - 7) * 2) + (minutoNum >= 30 ? 1 : 0);
              
              if (slotIndex >= 0 && slotIndex + slotsNecessarios <= 30) { // 7h-21h em slots de 30min (28 slots)
                // Verificar se j√° existe um agendamento nestes slots
                let slotDisponivel = true;
                for (let i = 0; i < slotsNecessarios; i++) {
                  if (agendamentosColuna.children[slotIndex + i].querySelector('.appointment') !== null) {
                    slotDisponivel = false;
                    break;
                  }
                }
                
                if (slotDisponivel) {
                  let appointmentClass = 'appointment-primary';
                  if (proc.faltou) {
                    appointmentClass = 'appointment-warning';
                  } else if (new Date(proc.data + 'T' + proc.hora) < new Date()) {
                    appointmentClass = 'appointment-success';
                  }
                  
                  // Criar o appointment no primeiro slot
                  const appointmentDiv = document.createElement('div');
                  appointmentDiv.className = `appointment ${appointmentClass}`;
                  appointmentDiv.style.height = `${slotsNecessarios * 60}px`; // Altura baseada em slots
                  appointmentDiv.innerHTML = `
                    <div class="appointment-title">${cliente.nome}</div>
                    <div class="appointment-time">${proc.procedimento} - ${proc.hora}</div>
                    <div class="appointment-duration">${duracao} min</div>
                    ${proc.pacote ? `<div class="appointment-package"><small>Pacote: ${proc.pacote}</small></div>` : ''}
                  `;
                  appointmentDiv.onclick = () => abrirModalAgendamento(clienteIndex, procIndex);
                  
                  // Adicionar ao primeiro slot e remover dos slots seguintes
                  for (let i = 0; i < slotsNecessarios; i++) {
                    if (i === 0) {
                      agendamentosColuna.children[slotIndex + i].appendChild(appointmentDiv);
                    } else {
                      // Para slots seguintes, apenas marcar como ocupado
                      const ocupadoDiv = document.createElement('div');
                      ocupadoDiv.className = 'appointment-occupied';
                      ocupadoDiv.style.height = '100%';
                      agendamentosColuna.children[slotIndex + i].appendChild(ocupadoDiv);
                    }
                  }
                }
              }
            }
          }
        });
      });
    }
    function carregarAgendamentosSemanais() {
      const dataInicio = new Date(document.getElementById('dataSemana').value);
      if (isNaN(dataInicio.getTime())) return;
      
      // Ajustar para come√ßar na segunda-feira
      const diaSemana = dataInicio.getDay();
      const diff = dataInicio.getDate() - diaSemana + (diaSemana === 0 ? -6 : 1); // Ajuste para segunda-feira
      dataInicio.setDate(diff);
      
      const agendaSemanal = document.getElementById('agenda-semanal');
      agendaSemanal.innerHTML = '';
      
      // Criar cabe√ßalho com os dias da semana
      const diasSemana = ['Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado', 'Domingo'];
      const cabecalho = document.createElement('div');
      cabecalho.style.display = 'grid';
      cabecalho.style.gridTemplateColumns = 'repeat(7, 1fr)';
      cabecalho.style.marginBottom = '10px';
      cabecalho.style.fontWeight = 'bold';
      cabecalho.style.textAlign = 'center';
      
      diasSemana.forEach((dia, i) => {
        const dataDia = new Date(dataInicio);
        dataDia.setDate(dataInicio.getDate() + i);
        
        const diaDiv = document.createElement('div');
        diaDiv.textContent = `${dia} (${dataDia.getDate()}/${dataDia.getMonth() + 1})`;
        cabecalho.appendChild(diaDiv);
      });
      
      agendaSemanal.appendChild(cabecalho);
      
      // Criar linhas com agendamentos
      const linhasDiv = document.createElement('div');
      linhasDiv.style.display = 'grid';
      linhasDiv.style.gridTemplateColumns = 'repeat(7, 1fr)';
      linhasDiv.style.gap = '10px';
      
      diasSemana.forEach((_, i) => {
        const dataDia = new Date(dataInicio);
        dataDia.setDate(dataInicio.getDate() + i);
        const dataStr = dataDia.toISOString().split('T')[0];
        
        const diaDiv = document.createElement('div');
        diaDiv.style.minHeight = '200px';
        diaDiv.style.border = '1px solid #eee';
        diaDiv.style.padding = '10px';
        diaDiv.style.borderRadius = '5px';
        
        const agendamentosDia = [];
        
        clientes.forEach(cliente => {
          cliente.procedimentos.forEach(proc => {
            if (proc.data === dataStr && !proc.cancelado) {
              agendamentosDia.push({
                cliente,
                proc,
                hora: proc.hora
              });
            }
          });
        });
        
        // Ordenar por hor√°rio
        agendamentosDia.sort((a, b) => a.hora.localeCompare(b.hora));
        
        if (agendamentosDia.length === 0) {
          diaDiv.innerHTML = '<p style="color:#999; font-style:italic;">Nenhum agendamento</p>';
        } else {
          agendamentosDia.forEach(ag => {
            const agDiv = document.createElement('div');
            agDiv.className = 'card';
            agDiv.style.marginBottom = '5px';
            agDiv.style.padding = '5px';
            agDiv.style.fontSize = '0.9rem';
            
            let statusClass = 'status-scheduled';
            if (ag.proc.faltou) {
              statusClass = 'status-missed';
            } else if (new Date(ag.proc.data + 'T' + ag.proc.hora) < new Date()) {
              statusClass = 'status-completed';
            }
            
            agDiv.innerHTML = `
              <div style="display:flex; justify-content:space-between;">
                <span><span class="${statusClass}"></span> <strong>${ag.proc.hora}</strong></span>
                <span>${ag.proc.procedimento}</span>
              </div>
              <div>${ag.cliente.nome}</div>
              ${ag.proc.pacote ? `<div><small>Pacote: ${ag.proc.pacote}</small></div>` : ''}
            `;
            
            diaDiv.appendChild(agDiv);
          });
        }
        
        linhasDiv.appendChild(diaDiv);
      });
      
      agendaSemanal.appendChild(linhasDiv);
    }

    function carregarAgendamentosMensais() {
      const mesAno = document.getElementById('dataMes').value;
      if (!mesAno) return;
      
      const [ano, mes] = mesAno.split('-');
      const primeiroDia = new Date(ano, mes - 1, 1);
      const ultimoDia = new Date(ano, mes, 0);
      
      const agendaMensal = document.getElementById('agenda-mensal');
      agendaMensal.innerHTML = '<p style="color:#666;">Carregando agendamentos do m√™s...</p>';
      
      // Simular carregamento ass√≠ncrono
      setTimeout(() => {
        agendaMensal.innerHTML = '';
        
        // Agrupar agendamentos por dia
        const agendamentosPorDia = {};
        
        clientes.forEach(cliente => {
          cliente.procedimentos.forEach(proc => {
            const [procAno, procMes, procDia] = proc.data.split('-');
            if (procAno === ano && procMes === mes && !proc.cancelado) {
              if (!agendamentosPorDia[procDia]) {
                agendamentosPorDia[procDia] = [];
              }
              
              agendamentosPorDia[procDia].push({
                cliente,
                proc
              });
            }
          });
        });
        
        // Criar calend√°rio
        const calendarioDiv = document.createElement('div');
        calendarioDiv.style.display = 'grid';
        calendarioDiv.style.gridTemplateColumns = 'repeat(7, 1fr)';
        calendarioDiv.style.gap = '5px';
        calendarioDiv.style.marginTop = '10px';
        
        // Cabe√ßalho com dias da semana
        const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
        diasSemana.forEach(dia => {
          const diaDiv = document.createElement('div');
          diaDiv.style.textAlign = 'center';
          diaDiv.style.fontWeight = 'bold';
          diaDiv.style.padding = '5px';
          diaDiv.style.background = '#f0f0f0';
          diaDiv.textContent = dia;
          calendarioDiv.appendChild(diaDiv);
        });
        
        // Dias vazios no in√≠cio (se o m√™s n√£o come√ßar na segunda)
        const primeiroDiaSemana = primeiroDia.getDay();
        for (let i = 0; i < primeiroDiaSemana; i++) {
          const vazioDiv = document.createElement('div');
          vazioDiv.style.minHeight = '80px';
          vazioDiv.style.background = '#f9f9f9';
          calendarioDiv.appendChild(vazioDiv);
        }
        
        // Dias do m√™s
        for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
          const diaDiv = document.createElement('div');
          diaDiv.style.minHeight = '80px';
          diaDiv.style.padding = '5px';
          diaDiv.style.border = '1px solid #eee';
          diaDiv.style.position = 'relative';
          
          const diaNumDiv = document.createElement('div');
          diaNumDiv.textContent = dia;
          diaNumDiv.style.fontWeight = 'bold';
          diaNumDiv.style.marginBottom = '5px';
          diaDiv.appendChild(diaNumDiv);
          
          const diaStr = dia.toString().padStart(2, '0');
          if (agendamentosPorDia[diaStr]) {
            const countDiv = document.createElement('div');
            countDiv.textContent = `${agendamentosPorDia[diaStr].length} agendamento(s)`;
            countDiv.style.fontSize = '0.8rem';
            countDiv.style.color = '#666';
            diaDiv.appendChild(countDiv);
            
            // Adicionar tooltip com detalhes
            diaDiv.title = agendamentosPorDia[diaStr]
              .map(ag => `${ag.proc.hora} - ${ag.cliente.nome}: ${ag.proc.procedimento}`)
              .join('\n');
            
            // Destaque se houver agendamentos
            diaDiv.style.background = '#f0f8ff';
            diaDiv.style.cursor = 'pointer';
            diaDiv.onclick = () => {
              document.getElementById('dataAgendamento').value = `${ano}-${mes}-${diaStr}`;
              mostrar('agendamentos');
              mudarAbaAgendamento('diario');
            };
          }
          
          calendarioDiv.appendChild(diaDiv);
        }
        
        agendaMensal.appendChild(calendarioDiv);
      }, 500);
    }

    function editarAgendamento(clienteIndex, procedimentoIndex) {
      const cliente = clientes[clienteIndex];
      const procedimento = cliente.procedimentos[procedimentoIndex];
      
      // Preencher formul√°rio de cliente com os dados existentes
      clienteEditandoIndex = clienteIndex;
      document.getElementById('modalClienteTitulo').textContent = `Editar Agendamento - ${cliente.nome}`;
      
      document.getElementById('nomeCliente').value = cliente.nome || '';
      document.getElementById('whatsCliente').value = cliente.whatsapp || '';
      document.getElementById('emailCliente').value = cliente.email || '';
      document.getElementById('obsCliente').value = cliente.observacoes || '';
      
      // Criar lista de procedimentos com apenas o procedimento sendo editado
      procedimentosTemp = cliente.procedimentos.filter((_, i) => i !== procedimentoIndex);
      procedimentosTemp.push({
        ...procedimento,
        editando: true,
        originalIndex: procedimentoIndex
      });
      
      atualizarListaProcedimentosModal();
      abrirModal('modalCliente');
    }

    function cancelarAgendamento(clienteIndex, procedimentoIndex) {
      if (confirm('Deseja realmente cancelar este agendamento? Uma mensagem ser√° enviada ao cliente.')) {
        const cliente = clientes[clienteIndex];
        const proc = cliente.procedimentos[procedimentoIndex];
        
        // Marcar como cancelado
        proc.cancelado = true;
        proc.canceladoEm = new Date().toISOString();
        
        // Enviar mensagem de cancelamento
        const msg = encodeURIComponent(
          `Ol√° ${cliente.nome}, lamentamos informar que seu agendamento para ${proc.procedimento} ` +
          `no dia ${formatarData(proc.data)} √†s ${proc.hora} foi cancelado.\n\n` +
          `Caso queira reagendar, por favor entre em contato conosco.`
        );
        window.open(`https://wa.me/${cliente.whatsapp}?text=${msg}`, '_blank');
        
        salvarLocal();
        
        // Atualizar visualiza√ß√£o
        const abaAtiva = document.querySelector('#agendamentos .tab.active').getAttribute('onclick');
        if (abaAtiva.includes('diario')) {
          carregarAgendamentosDiarios();
        } else if (abaAtiva.includes('semanal')) {
          carregarAgendamentosSemanais();
        } else if (abaAtiva.includes('mensal')) {
          carregarAgendamentosMensais();
        }
        
        carregarDashboard();
      }
    }

    function marcarFalta(clienteIndex, procedimentoIndex) {
      if (confirm('Deseja marcar este cliente como faltante? Uma mensagem ser√° enviada.')) {
        const cliente = clientes[clienteIndex];
        const proc = cliente.procedimentos[procedimentoIndex];
        
        // Marcar como faltou
        proc.faltou = true;
        proc.faltouEm = new Date().toISOString();
        
        // Enviar mensagem de falta
        const msg = encodeURIComponent(
          `Ol√° ${cliente.nome}, notamos que voc√™ n√£o compareceu ao seu agendamento para ${proc.procedimento} ` +
          `no dia ${formatarData(proc.data)} √†s ${proc.hora}.\n\n` +
          `Por favor, entre em contato para reagendarmos seu procedimento.`
        );
        window.open(`https://wa.me/${cliente.whatsapp}?text=${msg}`, '_blank');
        
        salvarLocal();
        
        // Atualizar visualiza√ß√£o
        const abaAtiva = document.querySelector('#agendamentos .tab.active').getAttribute('onclick');
        if (abaAtiva.includes('diario')) {
          carregarAgendamentosDiarios();
        } else if (abaAtiva.includes('semanal')) {
          carregarAgendamentosSemanais();
        }
        
        carregarDashboard();
      }
    }

    // Fun√ß√µes do dashboard
    function carregarDashboard() {
      // Total de clientes
      document.getElementById('total-clientes').textContent = clientes.length;
      
      // Total de agendamentos hoje
      const hoje = new Date().toISOString().split('T')[0];
      const agendamentosHoje = clientes.reduce((total, cliente) => {
        return total + (cliente.procedimentos || []).filter(p => p.data === hoje && !p.cancelado && !p.faltou).length;
      }, 0);
      document.getElementById('total-agendamentos').textContent = agendamentosHoje;
      
      // Total de procedimentos (habilitados)
      document.getElementById('total-procedimentos').textContent = procedimentos.filter(p => p.habilitado !== false).length;
      
      // Faturamento mensal (considerando apenas conclu√≠dos)
      const mesAtual = new Date().toISOString().slice(0, 7);
      const faturamento = clientes.reduce((total, cliente) => {
        (cliente.procedimentos || []).forEach(p => {
          const dt = new Date(p.data + 'T' + p.hora);
          if (p.data.startsWith(mesAtual)) {
            if (!p.cancelado && !p.faltou && dt < new Date()) {
              total += p.precoComDesconto || p.preco || 0;
            }
          }
        });
        return total;
      }, 0);
      document.getElementById('faturamento-mes').textContent = formatarMoeda(faturamento);
      
      // Carregar agenda do dia
      carregarAgendaHoje();
    }

    function carregarAgendaHoje() {
      const hoje = new Date().toISOString().split('T')[0];
      const agendaHoje = document.getElementById('agenda-hoje');
      agendaHoje.innerHTML = '';
      
      const agendamentos = [];
      
      clientes.forEach(cliente => {
        (cliente.procedimentos || []).forEach(proc => {
          if (proc.data === hoje && !proc.cancelado && !proc.faltou) {
            agendamentos.push({
              cliente,
              proc
            });
          }
        });
      });
      
      if (agendamentos.length === 0) {
        agendaHoje.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i> Nenhum agendamento para hoje.</div>';
        return;
      }
      
      // Ordenar por hor√°rio
      agendamentos.sort((a, b) => a.proc.hora.localeCompare(b.proc.hora));
      
      agendamentos.forEach(ag => {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.marginBottom = '10px';
        
        const horaAtual = new Date().getHours() + ':' + new Date().getMinutes().toString().padStart(2, '0');
        let statusClass = 'status-scheduled';
        let statusText = 'Agendado';
        
        if (ag.proc.hora < horaAtual) {
          statusClass = 'status-completed';
          statusText = 'Conclu√≠do';
        }
        
        card.innerHTML = `
          <div class="card-header">
            <div class="card-title">${ag.proc.hora} - ${ag.cliente.nome}</div>
            <span class="badge ${statusClass === 'status-scheduled' ? 'badge-primary' : 'badge-success'}">${statusText}</span>
          </div>
          <div class="card-body">
            <p><strong>Procedimento:</strong> ${ag.proc.procedimento} ${ag.proc.pacote ? `<span class="package-badge">${ag.proc.pacote}</span>` : ''}</p>
            <p><strong>WhatsApp:</strong> ${ag.cliente.whatsapp}</p>
            <p><strong>Dura√ß√£o:</strong> ${ag.proc.duracao || '30'} min</p>
            <p><strong>Valor:</strong> ${formatarMoeda(ag.proc.precoComDesconto || ag.proc.preco)} ${ag.proc.desconto ? `(Desconto de ${formatarMoeda(ag.proc.desconto)})` : ''}</p>
          </div>
          <div class="card-footer">
            <button class="btn-info btn-sm" onclick="contatarCliente('${ag.cliente.whatsapp}')">
              <i class="fab fa-whatsapp"></i> Contatar
            </button>
            <button class="btn-primary btn-sm" onclick="document.getElementById('dataAgendamento').value='${hoje}'; mostrar('agendamentos');">
              <i class="fas fa-calendar-day"></i> Ver Dia
            </button>
          </div>
        `;
        
        agendaHoje.appendChild(card);
      });
    }

    // Fun√ß√µes para verificar pacotes pendentes
    function verificarPacotesPendentes() {
      const hoje = new Date().toISOString().split('T')[0];
      
      clientes.forEach(cliente => {
        const pacotesPendentes = {};
        
        // Agrupa procedimentos por pacote
        cliente.procedimentos.forEach(proc => {
          if (proc.pacote && !proc.cancelado && !proc.faltou) {
            if (!pacotesPendentes[proc.pacote]) {
              pacotesPendentes[proc.pacote] = [];
            }
            pacotesPendentes[proc.pacote].push(proc);
          }
        });
        
        // Verifica pacotes com procedimentos pendentes
        for (const [pacoteNome, procedimentos] of Object.entries(pacotesPendentes)) {
          const pacote = pacotes.find(p => p.nome === pacoteNome);
          if (pacote && procedimentos.length < pacote.procedimentos.length) {
            const proximoProc = pacote.procedimentos.find(procNome => 
              !procedimentos.some(p => p.procedimento === procNome)
            );
            
            if (proximoProc) {
              const clienteIndex = clientes.indexOf(cliente);
              if (confirm(`O cliente ${cliente.nome} tem procedimentos pendentes do pacote ${pacoteNome}.\n\n` +
                         `Pr√≥ximo procedimento: ${proximoProc}\n\n` +
                         `Deseja agendar agora?`)) {
                abrirModalCliente(clienteIndex);
                return;
              }
            }
          }
        }
      });
    }

    // Fun√ß√µes de relat√≥rios
    function gerarRelatorioFaturamento() {
      const inicio = document.getElementById('dataInicioRelatorio').value;
      const fim = document.getElementById('dataFimRelatorio').value;
      
      if (!inicio || !fim) {
        alert('Por favor, selecione o per√≠odo para o relat√≥rio.');
        return;
      }
      
      // Calcular dados reais
      let totalAtendimentos = 0;
      let totalFaturamento = 0;
      const dadosPorDia = [];
      
      const dataInicio = new Date(inicio);
      const dataFim = new Date(fim);
      
      // Coletar dados
      clientes.forEach(cliente => {
        cliente.procedimentos.forEach(proc => {
          const dataProc = new Date(proc.data);
          if (dataProc >= dataInicio && dataProc <= dataFim && !proc.cancelado && !proc.faltou) {
            totalAtendimentos++;
            totalFaturamento += proc.precoComDesconto || proc.preco || 0;
            
            const dataStr = proc.data;
            const diaExistente = dadosPorDia.find(d => d.data === dataStr);
            if (diaExistente) {
              diaExistente.atendimentos++;
              diaExistente.faturamento += proc.precoComDesconto || proc.preco || 0;
            } else {
              dadosPorDia.push({
                data: dataStr,
                atendimentos: 1,
                faturamento: proc.precoComDesconto || proc.preco || 0
              });
            }
          }
        });
      });
      
      // Ordenar por data
      dadosPorDia.sort((a, b) => new Date(a.data) - new Date(b.data));
      
      // Gerar tabela
      let tabelaHTML = `
        <table style="width:100%; border-collapse:collapse; margin-top:1rem;">
          <thead>
            <tr style="background:#f0f0f0;">
              <th style="padding:10px; text-align:left;">Data</th>
              <th style="padding:10px; text-align:right;">Atendimentos</th>
              <th style="padding:10px; text-align:right;">Faturamento</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      dadosPorDia.forEach(dia => {
        tabelaHTML += `
          <tr style="border-bottom:1px solid #eee;">
            <td style="padding:10px;">${formatarData(dia.data)}</td>
            <td style="padding:10px; text-align:right;">${dia.atendimentos}</td>
            <td style="padding:10px; text-align:right;">${formatarMoeda(dia.faturamento)}</td>
          </tr>
        `;
      });
      
      tabelaHTML += `
          <tr style="font-weight:bold; background:#f9f9f9;">
            <td style="padding:10px;">Total</td>
            <td style="padding:10px; text-align:right;">${totalAtendimentos}</td>
            <td style="padding:10px; text-align:right;">${formatarMoeda(totalFaturamento)}</td>
          </tr>
          </tbody>
        </table>
      `;
      
      document.getElementById('grafico-faturamento').innerHTML = `
        <div class="alert alert-info">
          <i class="fas fa-chart-line"></i> Relat√≥rio de faturamento de ${formatarData(inicio)} a ${formatarData(fim)}
        </div>
      `;
      
      document.getElementById('tabela-faturamento').innerHTML = tabelaHTML;
    }

    function gerarRelatorioProcedimentos() {
      const periodo = document.getElementById('periodoProcedimentos').value;
      let dataInicio, dataFim;
      
      if (periodo === 'custom') {
        const dataCustom = document.getElementById('dataCustomProcedimentos').value;
        if (!dataCustom) {
          alert('Por favor, selecione uma data para o per√≠odo personalizado.');
          return;
        }
        dataInicio = new Date(dataCustom);
        dataFim = new Date();
      } else {
        dataFim = new Date();
        dataInicio = new Date();
        dataInicio.setDate(dataInicio.getDate() - parseInt(periodo));
      }
      
      // Calcular procedimentos mais realizados
      const procedimentosCount = {};
      
      clientes.forEach(cliente => {
        cliente.procedimentos.forEach(proc => {
          const dataProc = new Date(proc.data);
          if (dataProc >= dataInicio && dataProc <= dataFim && !proc.cancelado && !proc.faltou) {
            if (!procedimentosCount[proc.procedimento]) {
              procedimentosCount[proc.procedimento] = {
                count: 0,
                faturamento: 0
              };
            }
            procedimentosCount[proc.procedimento].count++;
            procedimentosCount[proc.procedimento].faturamento += proc.precoComDesconto || proc.preco || 0;
          }
        });
      });
      
      // Converter para array e ordenar
      const procedimentosArray = Object.entries(procedimentosCount).map(([nome, dados]) => ({
        nome,
        count: dados.count,
        faturamento: dados.faturamento
      })).sort((a, b) => b.count - a.count);
      
      // Gerar tabela
      let tabelaHTML = `
        <table style="width:100%; border-collapse:collapse; margin-top:1rem;">
          <thead>
            <tr style="background:#f0f0f0;">
              <th style="padding:10px; text-align:left;">Procedimento</th>
              <th style="padding:10px; text-align:right;">Quantidade</th>
              <th style="padding:10px; text-align:right;">Faturamento</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      procedimentosArray.forEach(proc => {
        tabelaHTML += `
          <tr style="border-bottom:1px solid #eee;">
            <td style="padding:10px;">${proc.nome}</td>
            <td style="padding:10px; text-align:right;">${proc.count}</td>
            <td style="padding:10px; text-align:right;">${formatarMoeda(proc.faturamento)}</td>
          </tr>
        `;
      });
      
      tabelaHTML += `
          </tbody>
        </table>
      `;
      
      document.getElementById('grafico-procedimentos').innerHTML = `
        <div class="alert alert-info">
          <i class="fas fa-chart-pie"></i> Relat√≥rio de procedimentos mais realizados (${periodo === 'custom' ? formatarData(dataInicio.toISOString().split('T')[0]) + ' at√© hoje' : '√∫ltimos ' + periodo + ' dias'})
        </div>
      `;
      
      document.getElementById('tabela-procedimentos').innerHTML = tabelaHTML;
    }

    function gerarRelatorioClientes() {
      const ordenacao = document.getElementById('ordenacaoClientes').value;
      const limite = parseInt(document.getElementById('limiteClientes').value);
      
      // Calcular dados dos clientes
      const clientesComDados = clientes.map(cliente => {
        const procedimentosCliente = (cliente.procedimentos || []).filter(p => !p.cancelado && !p.faltou);
        const valorGasto = procedimentosCliente.reduce((total, p) => total + (p.precoComDesconto || p.preco || 0), 0);
        const ultimoProcedimento = procedimentosCliente.length > 0 ? 
          new Date(procedimentosCliente[procedimentosCliente.length - 1].data + 'T' + procedimentosCliente[procedimentosCliente.length - 1].hora) : null;
        
        return {
          nome: cliente.nome,
          whatsapp: cliente.whatsapp,
          frequencia: procedimentosCliente.length,
          valorGasto,
          recencia: ultimoProcedimento ? ultimoProcedimento.getTime() : 0
        };
      });
      
      // Ordenar conforme sele√ß√£o
      if (ordenacao === 'frequencia') {
        clientesComDados.sort((a, b) => b.frequencia - a.frequencia);
      } else if (ordenacao === 'valor') {
        clientesComDados.sort((a, b) => b.valorGasto - a.valorGasto);
      } else if (ordenacao === 'recencia') {
        clientesComDados.sort((a, b) => b.recencia - a.recencia);
      }
      
      // Aplicar limite
      const clientesFiltrados = limite > 0 ? clientesComDados.slice(0, limite) : clientesComDados;
      
      // Gerar tabela
      let tabelaHTML = `
        <table style="width:100%; border-collapse:collapse; margin-top:1rem;">
          <thead>
            <tr style="background:#f0f0f0;">
              <th style="padding:10px; text-align:left;">Cliente</th>
              <th style="padding:10px; text-align:right;">Atendimentos</th>
              <th style="padding:10px; text-align:right;">Valor Gasto</th>
              <th style="padding:10px; text-align:right;">√öltimo Atendimento</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      clientesFiltrados.forEach(cliente => {
        const ultimoAtendimento = cliente.recencia ? new Date(cliente.recencia).toLocaleDateString('pt-BR') : 'Nunca';
        
        tabelaHTML += `
          <tr style="border-bottom:1px solid #eee;">
            <td style="padding:10px;">${cliente.nome}</td>
            <td style="padding:10px; text-align:right;">${cliente.frequencia}</td>
            <td style="padding:10px; text-align:right;">${formatarMoeda(cliente.valorGasto)}</td>
            <td style="padding:10px; text-align:right;">${ultimoAtendimento}</td>
          </tr>
        `;
      });
      
      tabelaHTML += `
          </tbody>
        </table>
      `;
      
      document.getElementById('grafico-clientes').innerHTML = `
        <div class="alert alert-info">
          <i class="fas fa-chart-bar"></i> Relat√≥rio de clientes ${ordenacao === 'frequencia' ? 'mais frequentes' : ordenacao === 'valor' ? 'que mais gastaram' : 'por rec√™ncia'}
        </div>
      `;
      
      document.getElementById('tabela-clientes').innerHTML = tabelaHTML;
    }

    function gerarRelatorioPacotes() {
      const periodo = parseInt(document.getElementById('periodoPacotes').value);
      const dataFim = new Date();
      const dataInicio = new Date();
      dataInicio.setDate(dataInicio.getDate() - periodo);
      
      // Calcular pacotes vendidos
      const pacotesVendidos = {};
      
      clientes.forEach(cliente => {
        const pacotesCliente = {};
        
        // Agrupar procedimentos por pacote
        cliente.procedimentos.forEach(proc => {
          if (proc.pacote && !proc.cancelado && !proc.faltou) {
            if (!pacotesCliente[proc.pacote]) {
              pacotesCliente[proc.pacote] = 0;
            }
            pacotesCliente[proc.pacote]++;
          }
        });
        
        // Contar pacotes completos
        Object.entries(pacotesCliente).forEach(([pacoteNome, count]) => {
          const pacote = pacotes.find(p => p.nome === pacoteNome);
          if (pacote && count >= pacote.procedimentos.length) {
            if (!pacotesVendidos[pacoteNome]) {
              pacotesVendidos[pacoteNome] = {
                count: 0,
                faturamento: 0
              };
            }
            pacotesVendidos[pacoteNome].count++;
            pacotesVendidos[pacoteNome].faturamento += pacote.preco;
          }
        });
      });
      
      // Converter para array e ordenar
      const pacotesArray = Object.entries(pacotesVendidos).map(([nome, dados]) => ({
        nome,
        count: dados.count,
        faturamento: dados.faturamento,
        procedimentos: pacotes.find(p => p.nome === nome).procedimentos
      })).sort((a, b) => b.count - a.count);
      
      // Gerar tabela
      let tabelaHTML = `
        <table style="width:100%; border-collapse:collapse; margin-top:1rem;">
          <thead>
            <tr style="background:#f0f0f0;">
              <th style="padding:10px; text-align:left;">Pacote</th>
              <th style="padding:10px; text-align:right;">Vendas</th>
              <th style="padding:10px; text-align:right;">Faturamento</th>
              <th style="padding:10px; text-align:left;">Procedimentos</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      pacotesArray.forEach(pacote => {
        tabelaHTML += `
          <tr style="border-bottom:1px solid #eee;">
            <td style="padding:10px;">${pacote.nome}</td>
            <td style="padding:10px; text-align:right;">${pacote.count}</td>
            <td style="padding:10px; text-align:right;">${formatarMoeda(pacote.faturamento)}</td>
            <td style="padding:10px;"><small>${pacote.procedimentos.join(', ')}</small></td>
          </tr>
        `;
      });
      
      tabelaHTML += `
          </tbody>
        </table>
      `;
      
      document.getElementById('grafico-pacotes').innerHTML = `
        <div class="alert alert-info">
          <i class="fas fa-box-open"></i> Relat√≥rio de pacotes vendidos (√∫ltimos ${periodo} dias)
        </div>
      `;
      
      document.getElementById('tabela-pacotes').innerHTML = tabelaHTML;
    }

    // Fun√ß√µes para backup
    function exportarBackup() {
      const dados = {
        clientes,
        procedimentos,
        pacotes,
        exportadoEm: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `backup-clinica-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function importarBackup(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const dados = JSON.parse(e.target.result);
          if (dados.clientes && dados.procedimentos && dados.pacotes) {
            if (confirm('Deseja importar os dados do backup? Isso substituir√° todos os dados atuais.')) {
              clientes = dados.clientes;
              procedimentos = dados.procedimentos;
              pacotes = dados.pacotes;
              salvarLocal();
              location.reload();
            }
          } else {
            alert('Arquivo de backup inv√°lido ou incompleto.');
          }
        } catch (error) {
          alert('Erro ao ler arquivo de backup: ' + error.message);
        }
      };
      reader.readAsText(file);
    }

    // Adicionar bot√µes de backup no HTML (voc√™ pode adicionar manualmente onde preferir)
    function adicionarBotoesBackup() {
      const backupDiv = document.createElement('div');
      backupDiv.style.position = 'fixed';
      backupDiv.style.bottom = '20px';
      backupDiv.style.right = '20px';
      backupDiv.style.display = 'flex';
      backupDiv.style.gap = '10px';
      
      const btnExportar = document.createElement('button');
      btnExportar.className = 'btn-primary';
      btnExportar.innerHTML = '<i class="fas fa-file-export"></i> Exportar Backup';
      btnExportar.onclick = exportarBackup;
      
      const btnImportar = document.createElement('button');
      btnImportar.className = 'btn-success';
      btnImportar.innerHTML = '<i class="fas fa-file-import"></i> Importar Backup';
      
      const inputImportar = document.createElement('input');
      inputImportar.type = 'file';
      inputImportar.accept = '.json';
      inputImportar.style.display = 'none';
      inputImportar.onchange = importarBackup;
      
      btnImportar.onclick = () => inputImportar.click();
      
      backupDiv.appendChild(btnExportar);
      backupDiv.appendChild(btnImportar);
      backupDiv.appendChild(inputImportar);
      
      document.body.appendChild(backupDiv);
    }

    // Chamar a fun√ß√£o para adicionar os bot√µes de backup
    adicionarBotoesBackup();
  </script>
</body>
</html>
